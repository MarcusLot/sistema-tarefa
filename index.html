<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema de Tarefas - Firebase</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(reg => {
                // Monitora atualiza√ß√µes do Service Worker
                reg.addEventListener('updatefound', () => {
                    const newWorker = reg.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // Nova vers√£o dispon√≠vel - abre o modal de atualiza√ß√£o
                            document.getElementById('modalUpdate').style.display = 'flex';
                        }
                    });
                });
            });
        }
    </script>
</head>
<body>

<div id="telaLogin" class="container">
    <h2>Login Funcion√°rio</h2>
    <input type="email" id="emailLogin" placeholder="E-mail" autocomplete="email" inputmode="email">
    <input type="password" id="senhaLogin" placeholder="Senha" autocomplete="current-password">
    <button id="btnLogar" onclick="fazerLogin()">Entrar</button>
</div>

<div id="sistema" class="container" style="display:none">
    <header class="app-header">
        <div class="user-info">
            <span class="user-name" id="usuarioLogado">Marcus Lot</span>
            <span class="user-role" id="cargoUsuario">Administrador</span>
        </div>
        <button onclick="logout()" class="btn-sair">Sair</button>
    </header>

    <div id="botoes-acao" class="actions-bar" style="display:none;">
        <button onclick="abrirModal('modalUser')" class="btn-secondary">+ Novo Funcion√°rio</button>
        <button onclick="abrirModal('modalTarefa')" class="btn-primary">+ Delegar Tarefa</button>
    </div>

    <div id="pwa-install-container" style="display: none; margin-bottom: 20px;">
        <button onclick="instalarPWA()" class="btn-primary" style="width: 100%; background: #059669; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span>üì• Instalar Aplicativo no Celular</span>
        </button>
    </div>

    <div class="dashboard-stats">
        <div class="stat-card">
            <span class="stat-label">Pendentes</span>
            <span class="stat-value" id="countPendentes">0</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">Conclu√≠das</span>
            <span class="stat-value" id="countConcluidas">0</span>
        </div>
    </div>

    <div style="margin-bottom: 20px;">
    <input type="text" id="inputBusca" placeholder="üîç Pesquisar por t√≠tulo ou descri√ß√£o..." oninput="filtrarTarefas()" style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0;">
</div>

<div class="secao-tarefas">
    <div class="header-retratil" onclick="toggleSecao('listaTarefasPendentes', 'setaPendentes')">
        <h3 style="margin:0;">‚è≥ Pendentes (<span id="badgePendentes">0</span>)</h3>
        <span id="setaPendentes">‚ñº</span>
    </div>
    <div id="listaTarefasPendentes" class="conteudo-retratil"></div>
</div>

<hr style="border: 0; border-top: 1px dashed #cbd5e1; margin: 40px 0;">

<div class="secao-tarefas">
    <div class="header-retratil" onclick="toggleSecao('listaTarefasConcluidas', 'setaConcluidas')">
        <h3 style="margin:0; color: #64748b;">‚úÖ Conclu√≠das (<span id="badgeConcluidas">0</span>)</h3>
        <span id="setaConcluidas">‚ñ∂</span>
    </div>
    <div id="listaTarefasConcluidas" class="conteudo-retratil" style="display:none;"></div>
</div>
</div>

<!-- Modal de Gerenciar Funcion√°rio -->
<div id="modalUser" class="modal-overlay">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
        <button class="btn-fechar" onclick="fecharModal('modalUser')">&times;</button>
        <h3>Gerenciar Funcion√°rios</h3>
        
        <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <input type="text" id="novoUserNome" placeholder="Nome Completo">
            <input type="email" id="novoUserEmail" placeholder="E-mail">
            <input type="password" id="novoUserSenha" placeholder="Senha (vazio para editar)">
            <select id="novoUserCargo">
                <option value="funcionario">Funcion√°rio</option>
                <option value="gerente">Gerente</option>
                <option value="administrador">Administrador</option>
            </select>
            <button onclick="criarUsuarioCompleto()" style="width: 100%;">Salvar Dados</button>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        <h4>Equipe Cadastrada</h4>
        <div id="listaUsuariosAdmin">
        </div>
    </div>
</div>

<!-- Modal de Delegar Tarefa -->
<div id="modalTarefa" class="modal-overlay">
    <div class="modal-content">
        <button class="btn-fechar" onclick="fecharModal('modalTarefa')">&times;</button>
        <h3>Delegar Nova Tarefa</h3>
        <input type="text" id="titulo" placeholder="T√≠tulo">
        <textarea id="descricao" placeholder="Descri√ß√£o" rows="3"></textarea>
        <label>Data de Entrega:</label>
        <input type="date" id="dataEntrega">
        <label>Urg√™ncia:</label>
        <select id="urgencia">
            <option value="baixa">Baixa üü¢</option>
            <option value="media">M√©dia üü°</option>
            <option value="alta">Alta üî¥</option>
        </select>
        <label>Respons√°vel:</label>
        <select id="atribuidoPara" onchange="mostrarEmailSelecionado()">
            <option value="">Selecione um funcion√°rio...</option>
        </select>
        <div id="emailAuxiliar" style="font-size: 12px; color: #6366f1; margin-top: -10px; margin-bottom: 10px; font-weight: 500;"></div>
        <button onclick="salvarTarefa()" style="width: 100%; margin-top: 10px;">Enviar Tarefa</button>
    </div>
</div>

<!-- Modal de Confirma√ß√£o de Exclus√£o -->
<div id="modalConfirmacao" class="modal-overlay">
    <div class="modal-content" style="text-align: center;">
        <div style="font-size: 50px; color: var(--danger);">‚ö†Ô∏è</div>
        <h3>Excluir esta tarefa?</h3>
        <p id="nomeTarefaExcluir" style="color: #666;"></p>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="btnConfirmarExcluir" style="background: var(--danger); flex: 1;">Sim, Excluir</button>
            <button onclick="fecharModal('modalConfirmacao')" style="background: #eee; color: #333; flex: 1;">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de Confirma√ß√£o de Sair -->
<div id="modalSair" class="modal-overlay">
    <div class="modal-content" style="text-align: center;">
        <div style="font-size: 50px; color: #64748b;">üö™</div>
        <h3>Deseja sair do sistema?</h3>
        <p style="color: #666;">Sua sess√£o ser√° encerrada neste dispositivo.</p>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="btnConfirmarSair" style="background: #ef4444; flex: 1;">Sim, Sair</button>
            <button onclick="fecharModal('modalSair')" style="background: #f1f5f9; color: #333; flex: 1;">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de Sucesso Universal -->
<div id="modalSucesso" class="modal-overlay" style="z-index: 2000;">
    <div class="modal-content" style="text-align: center; border-top: 5px solid var(--success);">
        <div style="font-size: 50px; margin-bottom: 10px;">‚úÖ</div>
        <h3 id="tituloSucesso">Sucesso!</h3>
        <p id="mensagemSucesso">Os dados foram atualizados.</p>
        <button onclick="fecharModal('modalSucesso')" style="width: 100%;">Ok</button>
    </div>
</div>

<!-- Modal de Atualiza√ß√£o -->
<div id="modalUpdate" class="modal-overlay" style="z-index: 3000;">
    <div class="modal-content" style="text-align: center; border-top: 5px solid var(--primary);">
        <div style="font-size: 50px; margin-bottom: 10px;">üöÄ</div>
        <h3>Nova Vers√£o Dispon√≠vel!</h3>
        <p>Atualizamos o sistema para voc√™. Deseja aplicar agora?</p>
        <button onclick="window.location.reload()" style="width: 100%; margin-top: 10px;">Atualizar Agora</button>
    </div>
</div>

<script type="module" src="script.js"></script>

</body>
</html>
