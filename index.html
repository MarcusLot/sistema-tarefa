<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Tarefas - Firebase</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(registration => {
                // Monitora atualiza√ß√µes do Service Worker
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // Nova vers√£o dispon√≠vel - mostra notifica√ß√£o
                            if (confirm('Nova vers√£o dispon√≠vel! Deseja atualizar agora?')) {
                                newWorker.postMessage({ type: 'SKIP_WAITING' });
                                window.location.reload();
                            }
                        }
                    });
                });
            });
        }
    </script>
</head>
<body>

<div id="telaLogin" class="container">
    <h2>Login Funcion√°rio</h2>
    <input type="email" id="emailLogin" placeholder="E-mail">
    <input type="password" id="senhaLogin" placeholder="Senha">
    <button id="btnLogar" onclick="fazerLogin()">Entrar</button>
</div>

<div id="sistema" class="container" style="display:none">
    <p>Bem-vindo: <b id="usuarioLogado"></b> (<span id="cargoUsuario"></span>) 
       <button onclick="fazerLogout()" style="width:auto; background:gray">Sair</button>
    </p>
    
    <div id="botoes-acao" class="botoes-acao">
        <button onclick="abrirModal('modalUser')">+ Novo Funcion√°rio</button>
        <button onclick="abrirModal('modalTarefa')" style="background: #6366f1;">+ Delegar Tarefa</button>
    </div>

    <div style="margin-bottom: 32px;">
        <h3>Minhas Tarefas / Painel</h3>
    </div>
    <div id="listaTarefas"></div>
</div>

<!-- Modal de Gerenciar Funcion√°rio -->
<div id="modalUser" class="modal-overlay">
    <div class="modal-content">
        <button class="btn-fechar" onclick="fecharModal('modalUser')">&times;</button>
        <h3>Gerenciar Funcion√°rio</h3>
        <input type="text" id="novoUserNome" placeholder="Nome Completo">
        <input type="email" id="novoUserEmail" placeholder="E-mail">
        <input type="password" id="novoUserSenha" placeholder="Senha (vazio para editar)">
        <select id="novoUserCargo">
            <option value="funcionario">Funcion√°rio</option>
            <option value="gerente">Gerente</option>
            <option value="administrador">Administrador</option>
        </select>
        <button onclick="criarUsuarioCompleto()" style="width: 100%;">Salvar Dados</button>
    </div>
</div>

<!-- Modal de Delegar Tarefa -->
<div id="modalTarefa" class="modal-overlay">
    <div class="modal-content">
        <button class="btn-fechar" onclick="fecharModal('modalTarefa')">&times;</button>
        <h3>Delegar Nova Tarefa</h3>
        <input type="text" id="titulo" placeholder="T√≠tulo">
        <textarea id="descricao" placeholder="Descri√ß√£o" rows="3"></textarea>
        <label>Data de Entrega:</label>
        <input type="date" id="dataEntrega">
        <label>Urg√™ncia:</label>
        <select id="urgencia">
            <option value="baixa">Baixa üü¢</option>
            <option value="media">M√©dia üü°</option>
            <option value="alta">Alta üî¥</option>
        </select>
        <label>Respons√°vel:</label>
        <select id="atribuidoPara"></select>
        <button onclick="salvarTarefa()" style="width: 100%; margin-top: 10px;">Enviar Tarefa</button>
    </div>
</div>

<!-- Modal de Confirma√ß√£o de Exclus√£o -->
<div id="modalConfirmacao" class="modal-overlay">
    <div class="modal-content" style="text-align: center;">
        <div style="font-size: 50px; color: var(--danger);">‚ö†Ô∏è</div>
        <h3>Excluir esta tarefa?</h3>
        <p id="nomeTarefaExcluir" style="color: #666;"></p>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="btnConfirmarExcluir" style="background: var(--danger); flex: 1;">Sim, Excluir</button>
            <button onclick="fecharModal('modalConfirmacao')" style="background: #eee; color: #333; flex: 1;">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de Sucesso Universal -->
<div id="modalSucesso" class="modal-overlay" style="z-index: 2000;">
    <div class="modal-content" style="text-align: center; border-top: 5px solid var(--success);">
        <div style="font-size: 50px; margin-bottom: 10px;">‚úÖ</div>
        <h3 id="mensagemSucesso">Dados atualizados com sucesso!</h3>
        <button onclick="fecharModal('modalSucesso')" style="background: #ddd; color: #333;">Fechar</button>
    </div>
</div>

<script type="module" src="script.js"></script>

</body>
</html>
